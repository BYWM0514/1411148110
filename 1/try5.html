<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>彰化縣</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: transparent;
      height: 100%;}
    .buttons {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 0;
      border: none;
      background: none;
      cursor: pointer;
    }
    button img {
      width: 100px;
      height: auto;
    }
    #btn3 {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
    }
    #btn3 img {
      width: 70px;   
      height: auto;
    }
  </style>
</head>
<body>
  <!-- 按鈕 -->
  <div class="buttons">
    <button id="btn1"><img src="P1.png" alt="按鈕1" /></button>
    <button id="btn2"><img src="P2.png" alt="按鈕2" /></button>
  </div>
  <button id="btn3" style="display:none;"><img src="P3.png" alt="按鈕3" /></button>
  <audio id="audioPlayer" src="1.mp3" preload="auto"></audio>

  <!-- A-Frame 場景 -->
  <a-scene
  mindar-image="imageTargetSrc: targets.mind; autoStart: true; uiScanning: true;"
  embedded
  color-space="sRGB"
  renderer="colorManagement: true; physicallyCorrectLights: true; alpha: true"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
>

    <a-assets>
      <video id="introVid" src="video.mp4" preload="auto" loop muted></video>
      <img id="popup1-img" src="1-1.JPG" />
      <img id="popup2-img" src="1-2.JPG" />
      <img id="popup3-img" src="1.jpg" />
    </a-assets>

    <a-camera look-controls="enabled: false" position="0 0 0"></a-camera>
    <a-light type="ambient" intensity="1.5"></a-light>

    <a-entity mindar-image-target="targetIndex: 0">
      <!-- 影片，預設隱藏 -->
      <a-video
        id="videoEntity"
        src="#introVid"
        width="1.6" height="0.9"
        autoplay="false"
        loop="true"
        material="shader: flat"
        position="0 0 0"
        visible="false"
      ></a-video>

      <!-- 圖片，預設隱藏 -->
      <a-image id="popup1" src="#popup1-img" position="0 0 0.01" width="1.5" height="1" visible="false"></a-image>
      <a-image id="popup2" src="#popup2-img" position="0 0 0.01" width="1.5" height="1" visible="false"></a-image>
      <a-image id="popup3" src="#popup3-img" position="0 0 0.01" width="1.5" height="1" visible="false"></a-image>
    </a-entity>
  </a-scene>

  <script>
    window.onload = () => {
      const video = document.querySelector('#introVid');
      const videoPlane = document.querySelector('#videoEntity');
      const targetEntity = document.querySelector('a-entity[mindar-image-target]');
      const popup1 = document.querySelector("#popup1");
      const popup2 = document.querySelector("#popup2");
      const popup3 = document.querySelector("#popup3");
      const btn1 = document.querySelector("#btn1");
      const btn2 = document.querySelector("#btn2");
      const btn3 = document.querySelector("#btn3");
      const audio = document.querySelector("#audioPlayer");

      // 點擊影片平面播放/暫停
      videoPlane.addEventListener('click', () => {
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      });

      // 掃描圖卡時：顯示影片、播放、出現音檔按鈕
      targetEntity.addEventListener('targetFound', () => {
        const imageVisible = popup1.getAttribute("visible") || popup2.getAttribute("visible") ;popup3.getAttribute("visible");
        if (!imageVisible) {
          videoPlane.setAttribute("visible", true);
          video.play();
           btn3.style.display = "inline"; // 顯示按鈕3
          }
        });

      // 離開圖卡時：全部隱藏與重設
      targetEntity.addEventListener('targetLost', () => {
        video.pause();
        video.currentTime = 0;
        videoPlane.setAttribute("visible", false);
        popup1.setAttribute("visible", false);
        popup2.setAttribute("visible", false);
        popup3.setAttribute("visible", false);
        audio.pause();
        audio.currentTime = 0;
        btn3.style.display = "none";
      });

      // 按鈕1：切換圖片1，圖片顯示時隱藏影片且暫停
      btn1.addEventListener("click", () => {
        const isVisible = popup1.getAttribute("visible");
        if (!isVisible) {
          popup1.setAttribute("visible", true);
          popup2.setAttribute("visible", false);
          video.pause();
          videoPlane.setAttribute("visible", false);
          popup3.setAttribute("visible", false); // 確保一開始先關掉第三張圖
        } else {
          popup1.setAttribute("visible", false);
          // videoPlane.setAttribute("visible", true); ← 這行改成顯示第三張圖片
          popup3.setAttribute("visible", true);
        }
      });

      // 按鈕2：切換圖片2，圖片顯示時隱藏影片且暫停
      btn2.addEventListener("click", () => {
        const isVisible = popup2.getAttribute("visible");
        if (!isVisible) {
          popup2.setAttribute("visible", true);
          popup1.setAttribute("visible", false);
          video.pause();
          videoPlane.setAttribute("visible", false);
          popup3.setAttribute("visible", false); // 確保一開始先關掉第三張圖
        } else {
          popup2.setAttribute("visible", false);
          // videoPlane.setAttribute("visible", true); ← 這行改成顯示第三張圖片
          popup3.setAttribute("visible", true);
        }
      });
      
      // 按下 btn3 撥放/暫停音樂
      btn3.addEventListener("click", () => {
        if (audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      });
    };

  </script>
</body>
</html>
